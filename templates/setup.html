<!DOCTYPE HTML>
<html>
<head>
    <title>Setup</title>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Andika&family=KoHo:wght@400&family=Tomorrow&display=swap');
    </style>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/general.css">
    <style>

    
    .input-field {
    width: 66%;
    border-radius: 5px;
    }
    
    .btn {
    width: 125px;
    color: #fff;
    background: green;
    }
    
    .portfolio_box {
    overflow: hidden;
    cursor: pointer;
    background: #46466f;
    border-radius: 25px;
    padding: 6px 10px;
    width: 718px;
    height: 72px;
    }
    
    .portfolio_box:hover {
    background: #4b4b77;
    }
    
    .box_wrapper {
    position: absolute;
    padding-bottom: 4px;
    }

.appear {
    -webkit-animation: to_appear 600ms;
    transform-style: preserve-3d;
}
.disappear {
    -webkit-animation: to_disappear 600ms;
    transform-style: preserve-3d;
}
@-webkit-keyframes to_appear {
    from {
        opacity: 0;
        -webkit-transform:translate(100%, 0%);
    }
    to {
        opacity: 1;
        -webkit-transform:translate(0%, 0%);
    }
}
@-webkit-keyframes to_disappear {
    from {
        -webkit-transform:translate(0%, 0%);
    }
    to {
        -webkit-transform:translate(-200%, 0%);
    }
}



.menubtn {
    background: #46466f;
    border-radius: 9px;
    width: 200px;
    font-family: Tomorrow, sans-serif;
    font-size: 20px;
    text-align: center;
    cursor: pointer;
    padding: 4px;
}

.menubtn:hover {
background: #4b4b77;
}

.api_option {
    border-bottom: 3px solid #4b4b77;
    display: inline;
    padding: 25px;
    padding-right: 50px;
}

.api_btn {
    background: #363656;
    color: #fff;
    width: 165px;
    font-family: Tomorrow, sans-serif;
    font-size: 20px;
    border-radius: 9px;
    border: 1px solid #363656;
    text-align: center;
    cursor: pointer;
    padding: 4px;
}

.api_btn:hover {
background: #4b4b77;
}


.api_input {
    background: #363656;
    color: #fff;
    width: 80%;
    font-family: Tomorrow, sans-serif;
    font-size: 20px;
    border-radius: 9px;
    border: 1px solid #363656;
    text-align: left;
    cursor: pointer;
    padding: 4px;
}

.api_input:hover {
background: #4b4b77;
}

.api_active {
    background: #5f5f96;
    border: 1px solid #5f5f96;
}

.container {
  display: block;
  position: relative;
  padding-left: 35px;
  margin-bottom: 12px;
  cursor: pointer;
  color: #fff;
  font-size: 16px;
  font-family: KoHo, sans-serif;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.container input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
}

.checkmark {
  position: absolute;
  top: 0;
  left: 0;
  height: 25px;
  width: 25px;
  background-color: #eee;
  border-radius: 50%;
}

.container:hover input ~ .checkmark {
  background-color: #ccc;
}

.container input:checked ~ .checkmark {
  background-color: #2196F3;
}

.checkmark:after {
  content: "";
  position: absolute;
  display: none;
}

.container input:checked ~ .checkmark:after {
  display: block;
}

.container .checkmark:after {
    top: 9px;
    left: 9px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: white;
}

svg {
	stroke-dasharray: 269.7405090332031px;
	stroke-dashoffset: 0;
	animation: heartBeat 10s linear reverse infinite;
	transform: rotate(-90deg);
}

@keyframes heartBeat {
	50% {
		stroke-dashoffset: 269.7405090332031px;
	}
	50.01% {
		stroke-dashoffset: -269.7405090332031px;
	}
}
    
    </style>
    <meta name="viewport" content="width=device-width">
</head>
<body id="body" style="background-color: #4d4b81; overflow: hidden; width: 100; height: 100%;">

    <div class="center" id="center">
    
        <div class="appear" id="page1" style="display: block;">
    
            <h1>Hello!</h1>
            <div>
                <h4>Thank you for downloading Peluno! To get started, you will be asked a few questions on how you would like to use this application.</h4>
            </div>
            <div style="padding-top: 25px;">
                <a onclick="Page(2)"><p class="menubtn" style="padding: 10px 6px;">Start</p></a>
            </div>

        </div>
        
        <div class="appear" id="page2" style="display: none;">
    
            <h1>API</h1>
            <div>
                <h4>In order to continue, you must agree to the Cryptowatch (API) <a style="color: #fff; text-decoration: underline;" target="_blank" href="https://cryptowat.ch/about/terms">Terms & Conditions</a></h4>
                <br>
                <input type="checkbox" autocomplete="off" id="noted_check" name="noted" onclick="return: false;">
                <h4 style="display: inline; font-size: 15px; font-family: Tomorrow; font-weight: 400;"><label for="noted"> I have read and agree to the terms & conditions.</label></h4>
            </div>
            <br>
            <br>
            <br>
            <div>
                <h4>Optional: You may wish to provide a cryptowatch API key. The program will operate the same without an API key, but risks being throttled by the API - this may impact your long-term market data. You can get a free API key <a style="text-decoration: none; color: #1ecbe1;" href="https://cryptowat.ch/">here</a>.</h4>
                <input id="crypto_api_key" autocomplete="off" placeholder="API Key ..." class="api_input"></input>
            </div>
            <div style="padding-top: 25px;">
                <a id="noted_btn_a"><p id="noted_btn" class="menubtn" style="color: #7c8180; padding: 10px 6px;">Next</p></a>
            </div>

        </div>
        
        <div class="appear" id="page3" style="display: none;">
    
            <h1>App Mode</h1>
            <div>
                <h4>Peluno has two modes available - Portfolio and Coin mode.</h4>
                <br>
                <h4 style="padding-top: 15px;">Portfolio mode will show you the value of what you own in your chosen currency.</h4>
                <h4>Coin mode will instead show you the standard value of 1.00 coin in your chosen currency.</h4>
                <br>
                <div style="width: 100%; background: #46466f; height: 75px; border-radius: 9px;">
                    <div style="height: 75px; padding: 10px;">
                        <label class="container">Portfolio Mode
                        <input id="mode_portfolio" autocomplete="off" type="radio" name="radio">
                        <span class="checkmark"></span>
                        </label>
                        <label class="container">Coin Mode
                        <input id="mode_coin" autocomplete="off" type="radio" name="radio">
                        <span class="checkmark"></span>
                        </label>
                    </div>
                </div>
                
                

            </div>
            <div style="padding-top: 25px;">
                <a id="mode_btn_a"><p id="mode_btn" class="menubtn" style="color: #7c8180; padding: 10px 6px;">Next</p></a>
            </div>

        </div>
        
        <div class="appear" id="page4" style="display: none;">
    
            <h1>Currency</h1>
            <div>
                <h4>Choose the native display currency you wish to use.</h4>
                <br>
                <div style="width: 100%; background: #46466f; height: 180px; border-radius: 9px;">
                    <div style="height: 75px; padding: 10px;">
                        <label class="container">USD ($)
                        <input id="currency_radio_usd" autocomplete="off" type="radio" name="radio">
                        <span class="checkmark"></span>
                        </label>
                        <label class="container">EUR (€)
                        <input id="currency_radio_eur" autocomplete="off" type="radio" name="radio">
                        <span class="checkmark"></span>
                        </label>
                        <label class="container">GBP (£)
                        <input id="currency_radio_gbp" autocomplete="off" type="radio" name="radio">
                        <span class="checkmark"></span>
                        </label>
                        <label class="container">CAD (C$)
                        <input id="currency_radio_cad" autocomplete="off" type="radio" name="radio">
                        <span class="checkmark"></span>
                        </label>
                        <label class="container">AUD (A$)
                        <input id="currency_radio_aud" autocomplete="off" type="radio" name="radio">
                        <span class="checkmark"></span>
                        </label>
                    </div>
                </div>
                <br>
                <h4>To use a currency other than USD, you <u>must</u> provide an API key for exchangerate-api.com. You can get a free API key <a style="text-decoration: none; color: #1ecbe1;" href="https://app.exchangerate-api.com/">here</a>.
                If you are unable to provide this key, you can use USD with no further issues.</h4>
                <input id="currency_api_key" autocomplete="off" oninput="APIInput()" placeholder="API Key ..." class="api_input"></input>

            </div>
            <div style="padding-top: 25px;">
                <a id="currency_btn_a"><p id="currency_btn" class="menubtn" style="color: #7c8180; padding: 10px 6px;">Next</p></a>
            </div>

        </div>
        
        <div class="appear" id="page5" style="display: none;">
    
            <h1>Markets</h1>
            <div>
                <h4>Select the markets you wish to monitor. Markets can be added/removed at any time beyond this setup.</h4>
                <br>
                <div style="width: 100%; background: #46466f; height: 320px; border-radius: 9px;">
                    <div style="height: 320px; padding: 10px; overflow-y: scroll;">
                        {% for entry in data['coins'] %}
                            <label class="container">{{ data['coins'][entry] }} ({{ entry }})
                            <input autocomplete="off" id="coin_{{ entry }}" type="checkbox">
                            <span class="checkmark"></span>
                            </label>
                        {% endfor %}
                    </div>
                </div>

            </div>
            <div style="padding-top: 25px;">
                <a onclick="Finish();"><p class="menubtn" style="padding: 10px 6px;">Finish</p></a>
            </div>

        </div>
        
        <div class="appear" id="page6" style="display: none; cursor: progress;">
    
            <h1 id="progress_text">Setting up your server. Please wait .</h1>
            <div style="padding-top: 60px;">
            </div>


        </div>
        
        
    </div>
<script>

currency = ["usd", "eur", "gbp", "cad", "aud"];
modes = ["portfolio", "coin"];






function sleep (time) {
  return new Promise((resolve) => setTimeout(resolve, time));
}

String.format = function() {
            var s = arguments[0];
            for (var i = 0; i < arguments.length - 1; i += 1) {
                var reg = new RegExp('\\{' + i + '\\}', 'gm');
                s = s.replace(reg, arguments[i + 1]);
            }
            return s;
        };  
        
function Page(n) {
    for (let i = 1; i < 6; i++) {
        document.getElementById(String.format("page{0}", i)).classList.remove("appear");
        document.getElementById(String.format("page{0}", i)).classList.add("disappear");
        document.getElementById(String.format("page{0}", i)).style.right = "5000px;"
    }
    sleep(600).then(() => {
        for (let i = 1; i < 6; i++) {
            document.getElementById(String.format("page{0}", i)).style.display = "none";
        }
        document.getElementById(String.format("page{0}", n)).classList.add("appear");
        document.getElementById(String.format("page{0}", n)).style.display = "block";
        for (let i = 1; i < 6; i++) {
            document.getElementById(String.format("page{0}", i)).classList.remove("disappear");
        }
    });

}

function getChosenMode() {
    return chosenMode;
}


function getChosenCurrency() {
    return chosenCurrency;
}

function getChosenMarkets() {
    coins = [];
    
    {% for entry in data['coins'] %}
    if (document.getElementById(String.format("coin_{0}", "{{ entry }}")).checked) {
        coins[coins.length] = "{{ entry }}";
    }
    {% endfor %}
    
    return coins;
}

function Finish() {
    Page(6);
    const config = {};
    config.mode = getChosenMode();
    config.currency = getChosenCurrency();
    config.monitorMarkets = getChosenMarkets();
    config.crypto_api_key = document.getElementById("crypto_api_key").value
    config.currency_api_key = document.getElementById("currency_api_key").value
    ConfigureServer(config);
    sleep(10000).then(() => {
        window.location.replace("/");
    });
}

function ConfigureServer(config) {
    var url = "/setup";
    var xhr = new XMLHttpRequest();
    xhr.open("POST", url, false);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.send(JSON.stringify(config));
}

document.getElementById("noted_check").addEventListener('change', (event) => {
  if (event.currentTarget.checked) {
    document.getElementById("noted_btn_a").onclick = function () {
         Page(3);
    }
    document.getElementById("noted_btn").style.color = "#fff";
  } else {
    document.getElementById("noted_btn_a").onclick = "";
    document.getElementById("noted_btn").style.color = "#7c8180";
  }
})

function APIInput() {
    if (document.getElementById("currency_api_key").value) {
        document.getElementById("currency_btn_a").onclick = function () {
            Page(5);
        }
        document.getElementById("currency_btn").style.color = "#fff";
    }
    else {
    document.getElementById("currency_btn_a").onclick = "";
    document.getElementById("currency_btn").style.color = "#7c8180";
    }
}

for (let i = 0; i < currency.length; i++) {
    document.getElementById(String.format('currency_radio_{0}', currency[i])).addEventListener('change', (event) => {
    if (event.currentTarget.checked) {
        chosenCurrency = currency[i];
        if ((document.getElementById("currency_api_key").value.length > 5) || (currency[i] == "usd")) {
            document.getElementById("currency_btn_a").onclick = function () {
                Page(5);
            }
            document.getElementById("currency_btn").style.color = "#fff";
        }
        else {
        document.getElementById("currency_btn_a").onclick = "";
        document.getElementById("currency_btn").style.color = "#7c8180";
        }
    } else {
        document.getElementById("currency_btn_a").onclick = "";
        document.getElementById("currency_btn").style.color = "#7c8180";
    }
    })
}

for (let i = 0; i < modes.length; i++) {
    document.getElementById(String.format('mode_{0}', modes[i])).addEventListener('change', (event) => {
    if (event.currentTarget.checked) {
        document.getElementById("mode_btn_a").onclick = function () {
            Page(4);
        }
        chosenMode = modes[i];
        document.getElementById("mode_btn").style.color = "#fff";
    } else {
        document.getElementById("mode_btn_a").onclick = "";
        document.getElementById("mode_btn").style.color = "#7c8180";
    }
    })
}




function ProgressLoop() {
    elmnt = document.getElementById("progress_text");
    if (elmnt.textContent == "Setting up your server. Please wait .") {
        elmnt.textContent = "Setting up your server. Please wait ..";
    } else if (elmnt.textContent == "Setting up your server. Please wait ..") {
        elmnt.textContent = "Setting up your server. Please wait ...";
    } else {
        elmnt.textContent = "Setting up your server. Please wait .";
    }
    sleep(1200).then(() => {
        ProgressLoop();
    });
}



ProgressLoop();




</script>
</body>
</html>
